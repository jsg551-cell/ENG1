<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ENG1 Documents Page</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="container" role="main">
    <header>
      <div>
        <h1>ENG1 Documents Page</h1>
      </div>
    </header>

    <section>
      <div class="card" id="documents">
        <table aria-describedby="table1-desc">
          <thead>
            <tr>
              <th scope="col">Document</th>
              <th scope="col">Link</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                Arch1
                <div class="indented-doc">Initial design</div>
                <div class="indented-doc">Updated Item</div>
                <div class="indented-doc">Updated NPC</div>
              </td>
              <td>
                <a href="Deliverables/Arch1.pdf" class="small" download>Download PDF</a><br>
                <div class="indented-download"><a href="Deliverables/initial-architecture.png" class="small" download>Download PNG</a><br></div>
                <div class="indented-download"><a href="Deliverables/updated-item.png" class="small" download>Download PNG</a><br></div>
                <div class="indented-download"><a href="Deliverables/npc-updated.png" class="small" download>Download PNG</a><br></div>
              </td>
            </tr>
            <tr>
              <td>Impl1</td>
              <td><a href="Deliverables/Impl1.pdf" class="small" download>Download PDF</a></td>
            </tr>
            <tr>
              <td>Plan1</td>
              <td><a href="Deliverables/Plan1.pdf" class="small" download>Download PDF</a></td>
            </tr>
            <tr>
              <td>Req1</td>
              <td><a href="Deliverables/Req1.pdf" class="small" download>Download PDF</a></td>
            </tr>
            <tr>
              <td>Risk1</td>
              <td><a href="Deliverables/Risk1.pdf" class="small" download>Download PDF</a></td>
            </tr>
            <tr>
              <td>Escape from Uni.jar</td>
              <td><a href="Deliverables/Escape%20from%20Uni.jar" class="small" download>Download JAR</a></td>
            </tr>
            <tr>
              <td>Version control history</td>
              <td><a href="https://github.com/oakleysjf/Engineering-1-c3g5.git" class="small" download>Open page</a></td>
            </tr>
            <tr>
              <td>Escape from Uni.jar<</td>
              <td><a href="Deliverables/Escape%20from%20Uni.jar" class="small" download>Download JAR</a></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>
  <script>
    // Force downloads for local deliverable files by fetching them as blobs
    // This helps prevent browsers from opening PDFs inline and ensures
    // the file is saved. Requires the page to be served over HTTP(S).
    document.addEventListener('click', function (e) {
      var a = e.target.closest && e.target.closest('a[download]');
      if (!a) return;
      var href = a.getAttribute('href');
      if (!href) return;
      // Only handle links inside Deliverables/ (local files)
      if (!href.startsWith('Deliverables/')) return;
      e.preventDefault();
      fetch(href).then(function (resp) {
        if (!resp.ok) throw new Error('Network response was not ok');
        return resp.blob();
      }).then(function (blob) {
        var url = URL.createObjectURL(blob);
        // Use download attribute value if provided, otherwise use filename from href
        var dlAttr = a.getAttribute('download');
        var filename = dlAttr && dlAttr !== '' ? dlAttr : decodeURIComponent(href.split('/').pop());
        var link = document.createElement('a');
        link.style.display = 'none';
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        link.remove();
        // revoke after a short timeout to ensure the download has started
        setTimeout(function () { URL.revokeObjectURL(url); }, 1000);
      }).catch(function (err) {
        console.error('Download failed:', err);
        alert('Download failed: ' + err.message + '\nIf you opened the page with file:// protocol, start a local server (see instructions).');
      });
    });
  </script>
</body>
</html>
